repos:
  - id: /.*/
    workflow: conftest
    allowed_overrides: [workflow, apply_requirements]

workflows:
  conftest:
    plan:
      steps:
        - init
        - plan:
            extra_args: ["-out=plan.tfplan"]
        - run: terraform show -json plan.tfplan | conftest test --all-namespaces -p ../../../policy/ -
    apply:
      steps:
        - apply
