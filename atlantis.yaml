repos:
  - id: github.com/mailamiton/gcp-infra-using-terraform
    workflow: conftest
    allowed_overrides: [workflow, apply_requirements]

workflows:
  conftest:
    plan:
      steps:
        - init
        - plan
        - show
        - run: conftest test --all-namespaces -p policy/ -

projects:
  - name: team-ops-dev
    dir: terraform/teams/team-ops/dev
    workspace: default
    autoplan:
      when_modified: ["*.tf", "*.tfvars", "**/modules/**/*.tf"]
      enabled: true

  - name: team-ops-prod
    dir: terraform/teams/team-ops/prod
    workspace: default
    autoplan:
      when_modified: ["*.tf", "*.tfvars", "**/modules/**/*.tf"]
      enabled: true

  - name: team-data-dev
    dir: terraform/teams/team-data/dev
    workspace: default
    autoplan:
      when_modified: ["*.tf", "*.tfvars", "**/modules/**/*.tf"]
      enabled: true

  - name: global-org-policies
    dir: terraform/global/org-policies
    workspace: default
    autoplan:
      when_modified: ["*.tf", "*.tfvars", "**/modules/**/*.tf"]
      enabled: true
